{{#extend "ol-sample-modules-dsfr-layout"}}

{{#content "vendor"}}
        <link rel="stylesheet" href="{{ baseurl }}/dist/modules/GpfExtOlWfsFilter.css" />
        <script src="{{ baseurl }}/dist/modules/GpfExtOlWfsFilter.js"></script> 
        <link rel="stylesheet" href="{{ baseurl }}/dist/modules/GpfExtOlLayerSwitcher.css" />
        <script src="{{ baseurl }}/dist/modules/GpfExtOlLayerSwitcher.js"></script>
        <script src="{{ baseurl }}/dist/modules/GpfExtOlLayers.js"></script>
{{/content}}

{{#content "head"}}
        <title>Sample openlayers GetFeatureInfo</title>
{{/content}}

{{#content "style"}}
        <style>
            div#map {
                width: 100%;
                height: 80vh;
                background-image:url("{{ resources }}/geoportail-waiting.gif");
                background-position:center center;
                background-repeat:no-repeat;
            }
            .wrapper {
                display: flex;
                flex-direction: row;
                align-items: flex-start;
                align-content: flex-start;
                justify-content: flex-start;
            }
        </style>
{{/content}}

{{#content "body"}}
            <h2>Filtrage du WFS cartosp, avec les options par défaut</h2>
            <!-- map -->
            <div id="map">
            </div>
{{/content}}

{{#content "js"}}
    <script>
        var ThemesInfo = {
            "Administration locale": {
                markerPath: "http://localhost:4200/assets/images/mapmarker/administrations-locales/",
                topologies: [
                	"France services",
                    "Mairie",
                    "Point d'accueil numérique (Préfecture et Sous-préfecture)",
                    "Préfecture",
                    "Sous-préfecture"
                ]
            },
            "Droit, justice": {
                markerPath: "http://localhost:4200/assets/images/mapmarker/droit-justice/",
                topologies: [
                    "Conseil départemental d'accès au droit (CDAD)",
                    "Point-justice - France services ou relais d'accès au droit",
                    "Point-justice - Maison de la justice et du droit",
                    "Tribunal judiciaire"
                ]
            },
            "Economie, finances, consommation" : {
                markerPath: "http://localhost:4200/assets/images/mapmarker/finance/",
                topologies: [
                    "Trésorerie",
                    "Service des impôts des entreprises (SIE)",
                    "Service des impôts des particuliers (SIP)"
                ]
            },
            "Social, santé" : {
                markerPath: "http://localhost:4200/assets/images/mapmarker/social-sante/",
                topologies: [
                    "Maison de santé (L.6223-3)",
                    "Service d’aide médicale urgente (Samu)",
                    "Centre de Santé",
                    "Centres Locaux Information Coordination P.A .(C.L.I.C.)",
                    "Caisse d'allocations familiales (Caf)",
                    "Caisse d'assurance retraite et de la santé au travail (Carsat)",
                    "Caisse primaire d’assurance maladie (CPAM)",
                    "Centre Hospitalier (C.H.)",
                    "Centre Hospitalier Régional (C.H.R.)",
                    "Centre hospitalier universitaire (CHU)",
                    "Centres sociaux",
                    "Maison départementale des personnes handicapées (MDPH)",
                    "Mutualité sociale agricole (MSA), réseau local",
                    "Union de recouvrement des cotisations de sécurité sociale et d’allocations familiales (Urssaf)"                    
                ]
            },
            "Travail, emploi, formation": {
                markerPath: "http://localhost:4200/assets/images/mapmarker/emploi-formation/",
                topologies: [
                    "France Travail",
                    "Mission locale pour l'insertion professionnelle et sociale des jeunes (16-25 ans)"
                ]
            },
            "Environnement, logement, transports":  {
                markerPath: "http://localhost:4200/assets/images/mapmarker/environnement/",
                topologies: [
                    "Agence départementale d'information sur le logement (Adil)",
                    "Agence nationale de l’habitat (ANAH) - réseau local",
                    "Bureau d'aide aux victimes du tribunal judiciaire",
                    "Espace conseil France rénov'"
                ]
        }};

        var map;
        var createMap = function () {
            document.getElementById('map').style.backgroundImage = 'none';

            // Création de la map
            map = new ol.Map({
                target : "map",
                view : new ol.View({
                    center : [288074.8449901076, 6247982.515792289],
                    zoom : 6
                })
            });

            // Ajout de plusieurs couches différentes.
            var gpMaps = new ol.layer.GeoportalWMTS({
                layer: "GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2"
            });
            map.addLayer(gpMaps);

            var wfslayer = new ol.layer.GeoportalWFS({
                layer: "services_publics_test_20250213:carto_sp_interne",
                olParams : {
                    minZoom: 10,
                    style: function(feature){
                        return styleCache[feature.getProperties()['thematique']].style;
                    },
                    sourceParams: {
                        strategy: ol.loadingstrategy.bbox,
                    }
                }
            });
            map.addLayer(wfslayer);

            					// Appel du LayerSwitcher
            var layerSwitcher = new ol.control.LayerSwitcher({
                options : {
                    position : "bottom-left",
                    collapsed : true,
                    panel : true,
                    counter : true
                }
            });
            map.addControl(layerSwitcher);

            // Ajout du contrôle de gestion  des couches
            var WfsFilter = new ol.control.WfsFilter({
                position: "top-left",
                panel: true,
                cartospLayerName: "services_publics_test_20250213:carto_sp_interne",
                cartospThemesInfo: ThemesInfo
            });
            map.addControl(WfsFilter);

        };
        Gp.Services.getConfig({
            customConfigFile : "{{ resources }}/data/configuration/customConfig.json",
            callbackSuffix : "",
            timeOut : 20000,
            onSuccess : createMap,
            onFailure : (e) => {
                console.error(e);
            }
        });
    </script>
{{/content}}
{{/extend}}
